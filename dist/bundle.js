!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){var n=["./image/wall1.png"],o=["./image/floor1.png"],r=["./image/target1.png"],i=["./image/box1.png"],l=["./image/inBox1.png"],a=["./image/player1.png"],s=new Image;s.src=n[0];var c=new Image;c.src=o[0];var u=new Image;u.src=i[0];var d=new Image;d.src=l[0];var g=new Image;g.src=r[0];var y=new Image;y.src=a[0];var f=window.document.getElementById("canvas1"),p=window.document.getElementById("canvas2"),m={canv1:f,canv2:p,ctx1:f.getContext("2d"),ctx2:p.getContext("2d"),wallImg:s,floorImg:c,targetImg:g,boxImg:u,inBoxImg:d,playerImg:y,getWall(e){var t=new Image;return t.src=n[e],t},getFloor(e){var t=new Image;return t.src=o[e],t},getBox(e){var t=new Image;return t.src=r[e],t},getInBox(e){var t=new Image;return t.src=i[e],t},getBox(e){var t=new Image;return t.src=l[e],t},getPlayer(e){var t=new Image;return t.src=a[e],t}},v=f.getAttribute("width");m.ctx1.translate(v/2,0),m.ctx2.translate(v/2,0),e.exports=m},function(e,t,n){var o=n(4);function r(e){return JSON.parse(JSON.stringify(e))}console.log("data",o),window.maxIndex=o.legnth-1,e.exports={getData:function(e){return r(void 0===e?o:o[e]?o[e]:o[o.length-1])}}},function(e,t,n){n(3);var{ui:o}=n(5),{game:r}=n(6);o.setMove("up",r.up),o.setMove("right",r.right),o.setMove("down",r.down),o.setMove("left",r.left),o.setToGameBegin(r.init),o.setToMenu(r.end),r.setOverBack(()=>{setTimeout(o.result,300)}),o.cancleBtn.onclick=r.cancle.bind(null,void 0),o.replayBtn.onclick=r.reInitGame.bind(null,void 0)},function(e,t,n){n(9),n(14);var o,r,i,l,a,s,c,u=(o=navigator.userAgent,r=/(?:Windows Phone)/.test(o),i=/(?:SymbianOS)/.test(o)||r,l=/(?:Android)/.test(o),a=/(?:Firefox)/.test(o),/(?:Chrome|CriOS)/.test(o),s=/(?:iPad|PlayBook)/.test(o)||l&&!/(?:Mobile)/.test(o)||a&&/(?:Tablet)/.test(o),c=/(?:iPhone)/.test(o)&&!s,{isTablet:s,isPhone:c,isAndroid:l,isPc:!c&&!l&&!i});window.os=u,u.isTablet&&window.document.getElementById("keyboard").style.setProperty("visibility","visible"),function(e){var t=document.getElementById("contentL");t.innerHTML="",e>25&&(e=25);let n=new DocumentFragment;for(let t=1;t<=e;t++){var o=document.createElement("div");o.setAttribute("class","level"),o.dataset.index=t-1,o.innerHTML=t,n.appendChild(o)}t.appendChild(n)}(n(1).getData().length)},function(e){e.exports=[{size:[6,4],outterWalls:[[0,1],[0,3],[5,3],[5,0],[1,0],[1,1]],innerWalls:[],boxs:[[2,2]],targets:[[3,2]],palyer:[1,2]},{size:[6,4],outterWalls:[[0,1],[0,3],[5,3],[5,0],[1,0],[1,1]],innerWalls:[],boxs:[[2,2]],targets:[[1,2]],palyer:[1,2]},{size:[8,8],outterWalls:[[0,0],[0,7],[7,7],[7,0]],innerWalls:[[[4,2]]],boxs:[[2,2],[2,3]],targets:[[1,2],[5,5]],palyer:[1,2]},{size:[6,6],outterWalls:[[0,0],[0,5],[5,5],[5,0]],innerWalls:[[[2,3]]],boxs:[[2,2],[2,4],[3,3]],targets:[[4,2],[4,3],[4,4]],palyer:[3,2]},{size:[6,6],outterWalls:[[0,0],[0,5],[5,5],[5,0]],innerWalls:[[[2,3]]],boxs:[[2,2],[2,4],[3,3]],targets:[[1,2],[1,3],[1,4]],palyer:[3,2]},{size:[6,6],outterWalls:[[0,0],[0,5],[5,5],[5,0]],innerWalls:[[[2,3]]],boxs:[[2,2],[2,4],[3,3]],targets:[[1,2],[3,2],[1,4]],palyer:[3,4]},{size:[6,6],outterWalls:[[0,0],[0,5],[5,5],[5,0]],innerWalls:[[[2,3]]],boxs:[[2,2],[2,4],[3,3]],targets:[[1,2],[2,1],[1,4]],palyer:[3,4]},{size:[6,6],outterWalls:[[0,0],[0,5],[5,5],[5,0]],innerWalls:[[[2,3]]],boxs:[[2,2],[2,4],[3,3],[4,3]],targets:[[1,2],[2,1],[1,4],[4,1]],palyer:[4,4]},{size:[6,6],outterWalls:[[0,0],[0,4],[1,4],[1,5],[5,5],[5,2],[4,2],[4,0]],innerWalls:[],boxs:[[3,2],[2,3]],targets:[[1,1],[2,1]],palyer:[2,1]},{size:[6,6],outterWalls:[[0,0],[0,4],[2,4],[2,5],[5,5],[5,0]],innerWalls:[],boxs:[[2,2],[2,1],[2,3]],targets:[[1,1],[1,2],[2,1]],palyer:[1,1]},{size:[6,6],outterWalls:[[0,0],[0,5],[5,5],[5,0]],innerWalls:[],boxs:[[2,1],[2,2],[2,3],[2,4]],targets:[[2,1],[3,2],[3,3],[3,4]],palyer:[1,1]},{size:[6,7],outterWalls:[[1,0],[1,2],[0,2],[0,6],[5,6],[5,0]],innerWalls:[],boxs:[[2,2],[3,2],[4,2]],targets:[[3,1],[4,1],[3,2]],palyer:[2,1]},{size:[9,9],outterWalls:[[0,0],[0,4],[1,4],[1,5],[1,5],[1,8],[5,8],[5,7],[8,7],[8,2],[6,2],[6,4],[4,4],[4,0]],innerWalls:[[[2,4],[2,5]],[[5,6]]],boxs:[[2,2],[2,3],[3,2]],targets:[[7,3],[7,4],[7,5]],palyer:[1,1]},{size:[10,7],outterWalls:[[1,0],[1,2],[0,2],[0,5],[1,5],[1,6],[8,6],[8,4],[9,4],[9,1],[7,1],[7,0]],innerWalls:[[[3,2],[5,2]],[[4,4],[4,5]]],boxs:[[2,2],[7,3]],targets:[[2,4],[3,5]],palyer:[2,3]},{size:[10,7],outterWalls:[[1,0],[1,2],[0,2],[0,5],[1,5],[1,6],[8,6],[8,4],[9,4],[9,1],[7,1],[7,0]],innerWalls:[[[3,2],[5,2]],[[4,4],[4,5]]],boxs:[[2,2],[6,4],[7,3]],targets:[[2,5],[3,4],[3,5]],palyer:[2,3]},{size:[10,7],outterWalls:[[1,0],[1,2],[0,2],[0,5],[1,5],[1,6],[8,6],[8,4],[9,4],[9,1],[7,1],[7,0]],innerWalls:[[[3,2],[5,2]],[[4,4],[4,5]]],boxs:[[2,2],[4,3],[6,4],[7,3]],targets:[[2,4],[2,5],[3,4],[3,5]],palyer:[2,3]}]},function(e,t,n){var{canv1:o,canv2:r}=n(0),i=window.document.getElementById("cancleBtn"),l=window.document.getElementById("menuBtn"),a=window.document.getElementById("replayBtn"),s=window.document.getElementById("res"),c=window.document.getElementById("hardBtn"),u=window.document.getElementById("contentL");window.document.body.addEventListener("keyup",function(e){switch(e.keyCode){case 38:y("up");break;case 39:y("right");break;case 40:y("down");break;case 37:y("left")}e.stopPropagation()}),window.document.getElementById("upBtn").onclick=function(){y("up")},window.document.getElementById("leftBtn").onclick=function(){y("left")},window.document.getElementById("rightBtn").onclick=function(){y("right")},window.document.getElementById("downBtn").onclick=function(){y("down")},l.onclick=function(){f.toMenu(),u.style.setProperty("visibility","visible"),o.style.setProperty("visibility","hidden"),r.style.setProperty("visibility","hidden"),res.style.setProperty("visibility","hidden")},s.querySelector(".mybutton.to_menu").onclick=function(){res.style.setProperty("visibility","hidden"),l.click()};{let e=["全部难度","简单","中等","困难"];c.onclick=function(){var t=u.querySelectorAll(".level"),n=t.length;console.log(t,n);var o=~~c.dataset.level;o=e[o+1]?o+1:0,c.innerHTML=e[o],c.dataset.level=o;var r=[0,Math.max(n/3,1),Math.max(2*n/3,2),n];0==o&&(o=1,r[1]=n),console.log("level",o,r);for(let e=0;e<n;e++)e>=r[o-1]&&e<r[o]?t[e].classList.remove("hidden"):t[e].classList.add("hidden")}}function d(e){u.style.setProperty("visibility","hidden"),res.style.setProperty("visibility","hidden"),f.toGameBegin(e),o.style.setProperty("visibility","visible"),r.style.setProperty("visibility","visible")}window.document.getElementById("contentL").addEventListener("click",function(e){e.target.classList.contains("level")&&d(e.target.dataset.index)});var g=!0;function y(e){g&&(g=!1,setTimeout(g=!0,150),e=e.toLowerCase(),p[e]&&p[e]())}var f={toMenu:()=>{},toGameBegin:()=>{}},p={up:()=>{},down:()=>{},right:()=>{},left:()=>{}},m={setMove(e,t){e=e.toLowerCase(),p[e]&&(p[e]=t)},setToMenu(e){f.toMenu=e},setToGameBegin(e){f.toGameBegin=e},result:function(e){res.style.setProperty("visibility","visible"),document.getElementById("resword").innerHTML="游戏成功!";var t=res.querySelector(".mybutton.next");if(console.log(t),window.maxIndex&&window.index&&(console.log(111),window.maxIndex<=window.index))return console.log(222),t.innerHTML="通关!",void(t.onclick=function(){l.click()});console.log(33),t.innerHTML="下一关!",console.log(new Number(window.index)+1),t.onclick=function(){d(new Number(window.index)+1)}},cancleBtn:i,replayBtn:a};e.exports={ui:m}},function(e,t,n){var{getData:o}=n(1),{SokoMap:r}=n(7),{Box:i,Player:l}=n(8);const a=n(0).canv1.width,s=80;var c=!1,u={sokoMap:[],box:[],player:{},score:0,isWin:!1,history:[]};var d=-1;function g(e=0){if(console.log("run is"+e),data=o(e),console.log("run is",data),!data)return;d=e,window.index=e,function(e){u.sokoMap=[],u.box=[],u.player={},u.score=e.targets.length,u.isWin=!1,u.history=[]}(data);var t=Math.max(data.size[0],data.size[1]),n=Math.min(parseInt(a/t),s),g=data.size[0]/2;u.sokoMap=new r(data,n).draw();let y={blockSize:n,centerIndex:g};for(let e of data.boxs){let t=u.sokoMap[e[0]][e[1]],n=new i(e[0],e[1],y).draw();t.isTarget&&(n.setIsIn(t.isTarget),u.score--),u.box.push(n),t.box=n}u.player=new l(data.palyer[0],data.palyer[1],y).draw(),c=!0}function y(){}function f(e,t){var n,o,r=u.player.x+e,i=u.player.y+t;console.log(r,i),console.log(u.sokoMap[r][i]);try{o=(n=u.sokoMap[r][i]).isWall}catch(e){return void console.log("越界")}var l=!1;if(o)console.log("石墙");else{if(n.box){if(!u.sokoMap[r+e][i+t])return void console.log("二级越界");if(console.log(u.sokoMap[r+e][i+t].box,u.sokoMap[r+e][i+t].isWall,u.sokoMap[r+e][i+t].box||u.sokoMap[r+e][i+t].isWall),u.sokoMap[r+e][i+t].box||u.sokoMap[r+e][i+t].isWall)return void console.log("二级箱子");l=!0,p(r,i,e,t)}console.log("走起"),u.history.push([e,t,l]),u.player.move(e,t),u.score<=0&&(u.isWin=!0,c=!1,y())}}function p(e,t,n,o){var r=u.sokoMap[e][t],i=r.box,l=u.sokoMap[e+n][t+o];i&&(i.isIn&&(i.setIsIn(!1),u.score++),l.isTarget&&(i.setIsIn(!0),u.score--),console.log("推箱子"),i.move(n,o),l.box=i,r.box=null)}u.setOverBack=function(e=(()=>{})){y=e},u.end=function(){c=!1},u.init=g,u.up=function(){c&&f(0,-1)},u.down=function(){c&&f(0,1)},u.left=function(){c&&f(-1,0)},u.right=function(){c&&f(1,0)},u.cancle=function(e=1){if(c)for(;e>0;){let t=u.history.pop();if(!t)return;let n=t[0],o=t[1];u.player.move(-n,-o),t[2]&&u.sokoMap[u.player.x+2*n][u.player.y+2*o].box&&p(u.player.x+2*n,u.player.y+2*o,-n,-o),e--}},u.reInitGame=function(){c&&g(d)},e.exports={game:u}},function(e,t,n){var o=n(0),{canv1:r,ctx1:i,ctx2:l}=o,{wallImg:a,floorImg:s,targetImg:c}=o;function u(e,t,n){e=e.slice(0),t=t.slice(0),n=n||function(){};var o=[];if(e[0]===t[0]){let r=t[1]-e[1];if(0===r)return n(e[0],e[1]),[e];let i=Math.abs(r)/r,l=e[0],a=t[1]+i;for(;e[1]!=a;e[1]+=i){let t=e[1];o.push([l,t]),n(l,t)}}else{if(e[1]!==t[1])return null;{let r=t[0]-e[0];if(0===r)return n(e[0],e[1]),[e];let i=Math.abs(r)/r,l=t[1],a=t[0]+i;for(;e[0]!=a;e[0]+=i){let t=e[0];o.push([t,l]),n(t,l)}}}return o}function d(e,t,n){i.drawImage(a,e,t,n,n)}function g(e,t,n){i.drawImage(s,e,t,n,n)}function y(e,t,n){i.drawImage(c,e,t,n,n)}e.exports={SokoMap:function(e,t){var{size:n,outterWalls:o,innerWalls:r,targets:a}=e,s=new Array(n[0]);for(let e=0;e<s.length;e++){s[e]=new Array(n[1]);for(let t=0;t<n[1];t++)s[e][t]={isWall:!1,box:null,isTarget:!1}}return console.log(e),console.log(s),Object.defineProperty(s,"draw",{value:function(){i.clearRect(-600,0,2e3,2e3),l.clearRect(-600,0,2e3,2e3);var e=n[0]/2;return function(e,t,n,o){for(let e=0;e<t.length;e++){let n=t[e],o=t[e+1]?t[e+1]:t[0];u(n,o,r)}function r(t,r){d(o*(t-n),o*r,o),e[t][r].isWall=!0}}(s,o,e,t),function(e,t,n){for(let o in e){let r=!1,i=!1;for(let l in e[o])if(e[o][l].isWall)i=r?i:!i,r=!0;else if(i){if(0==o||o==e.length-1)continue;r=!1,g(n*(o-t),n*l,n)}}}(s,e,t),function(e,t,n,o){for(let e of t){let n=e[0],o=e[1]?e[1]:e[0];console.log(e,n,o,t),u(n,o,r)}function r(t,r){i.clearRect(o*(t-n),o*r,o,o),d(o*(t-n),o*r,o),e[t][r].isWall=!0}}(s,r,e,t),function(e,t,n,o){for(let r of t)e[r[0]][r[1]].isTarget=!0,y(o*(r[0]-n),o*r[1],o)}(s,a,e,t),this}}),s}}},function(e,t,n){var o=n(0),{canv2:r,ctx2:i}=o,{playerImg:l,boxImg:a,inBoxImg:s}=o;class c{constructor(e,t,n={}){this.x=e,this.y=t,this.data=n}draw(){}clear(){}move(e=0,t=0){this.clear(),this.x+=e,this.y+=t,this.draw()}}c.prototype.clear=function(e,t){e=e||this.data.centerIndex,t=t||this.data.blockSize,i.clearRect(t*(this.x-e),t*this.y,t,t)};class u extends c{constructor(e,t,n){super(e,t,n)}}u.prototype.draw=function(e,t){return e=e||this.data.centerIndex,t=t||this.data.blockSize,i.drawImage(l,t*(this.x-e),t*this.y,t,t),this};class d extends c{constructor(e,t,n){super(e,t,n),this.isIn=!1}setIsIn(e){return e?console.log("各自如龙"):console.log("格子出笼"),this.isIn!=e&&(this.clear(),this.isIn=e,this.draw()),this}}d.prototype.draw=function(e,t){e=e||this.data.centerIndex,t=t||this.data.blockSize;let n=a;this.data.isIn&&(n=inBox);return i.drawImage(n,t*(this.x-e),t*this.y,t,t),this},e.exports={Player:u,Box:d}},function(e,t){},,,,,function(e,t){}]);